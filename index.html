<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reproductor de video M3U8</title>
    <link href="https://vjs.zencdn.net/8.6.1/video-js.css" rel="stylesheet" />
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #1a1a1a;
            color: #fff;
            overflow: hidden; /* Prevent scrollbars on the body */
        }

        /* Main container */
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh; /* Full viewport height */
            width: 100%;  /* Full viewport width */
            max-width: none; /* Remove max-width */
            margin: 0; /* Remove margins */
            padding: 0; /* Remove padding */
            background-color: #2a2a2a;
             /* Remove border-radius, let the video element handle it */
        }

        /* Video player container */
        #player-container {
            position: relative; /* Needed for absolute positioning of the video */
            width: 100%;
            height: 100%; /* Occupy full container height in portrait */
            overflow: hidden; /* Hide any overflowing content */

        }

        #my-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: contain; /* Important: Ensure video fits within, maintaining aspect ratio */
            border-radius: 0; /* Remove any border radius from here */
        }


        /* Hide playlist container initially in portrait mode */
        #playlist-container {
          display: none;
        }

        .vjs-error .vjs-error-display .vjs-modal-dialog-content{
            color: white;
            font-size: 1.5em;
          }

        /* Fullscreen styles (keep as before, for landscape) */
          .vjs-fullscreen {
            position: fixed !important;
            top: 0 !important;
            left: 0 !important;
            width: 100% !important;
            height: 100% !important;
            z-index: 9999 !important;
        }

        /* Landscape mode styles */
        @media (orientation: landscape) {
          .container{
            flex-direction: row;
            border-radius: 10px;

          }
            #player-container {
                flex: 3;
                height: auto;  /* Let it adjust its height */
                padding-top: 0; /* Remove the padding-top trick in landscape */
                margin-right: 20px;
                border-radius: 10px;
            }

            #my-video{
              object-fit: cover;
            }

            #playlist-container {
                flex: 1;
                display: flex; /* Show the playlist */
                flex-direction: column; /* Stack items vertically */
                overflow-y: auto; /* Allow scrolling within the playlist */
                padding: 15px;
                background-color: #333;
                border-radius: 10px;

            }

            /* Styles for search and list items (same as before) */
             #search {
                padding: 10px;
                margin-bottom: 15px;
                border: 1px solid #444;
                border-radius: 5px;
                background-color: #444;
                color: #fff;
                font-size: 1em;
            }
             #playlist {
                list-style-type: none;
                padding: 0;
                margin: 0;
                flex: 1;
                overflow-y: auto;
            }

            #playlist li {
              padding: 10px;
              border: 1px solid #444;
              margin-bottom: 10px;
              display: flex;
              justify-content: space-between;
              align-items: center;
              background-color: #444;
              border-radius: 5px;
              transition: background-color 0.3s ease, transform 0.2s ease;
              cursor: pointer;
          }

          #playlist li:hover {
              background-color: #555;
              transform: translateY(-2px);
          }

          #playlist li.active {
              background-color: #4CAF50;
          }

          #playlist li span {
              font-size: 1em;
              color: #fff;
          }

          h2 {
            font-size: 1.5em;
            color: #ccc;
            margin-bottom: 10px;
        }
        }
    </style>
</head>
<body>
    <div class="container">
        <div id="player-container">
            <video id="my-video" class="video-js vjs-default-skin vjs-big-play-centered" controls preload="auto"  aria-label="Reproductor de video">
                <source src="" type="application/x-mpegURL">
            </video>
        </div>
        <div id="playlist-container">
            <h2>Lista de reproducción</h2>
            <input type="text" id="search" placeholder="Buscar canal..." oninput="filterPlaylist()">
            <ul id="playlist"></ul>
        </div>
    </div>

    <script src="https://vjs.zencdn.net/8.6.1/video.min.js"></script>
    <script src="https://unpkg.com/@videojs/http-streaming@latest/dist/videojs-http-streaming.min.js"></script>
    <script>
        // --- JavaScript (same as the improved version, with fullscreen logic) ---
        const player = videojs('my-video', {
            fluid: false, // Important: Turn off fluid for manual control
            controls: true,
            preload: 'auto',
            responsive: false, // Turn off responsive
            playbackRates: [0.5, 1, 1.5, 2],
             html5: {
              vhs: {
                overrideNative: true
              }
            }
        });

          // Obtener elementos del DOM
        const playlistElement = document.getElementById('playlist');

        // Lista de reproducción predeterminada (moved outside for easier management)
        const defaultPlaylist = [
          { title: "Tele red", url: "https://k20.usastreams.com:8081/telered/index.m3u8" },
          { title: "Canal 13", url: "https://ssh101.bozztv.com/ssh101/sinart13/chunks.m3u8" },
          { title: "canal 36", url: "https://liveingesta118.cdnmedia.tv/trivision36live/smil:dvrlive.smil/playlist.m3u8" },
          { title: "Retro Tv", url: "https://ssh101-fl.bozztv.com/ssh101/retrotvcr/tracks-v1a1/mono.m3u8" },
          { title: "TELE Clasica", url: "https://ssh101-fl.bozztv.com/ssh101/teleclasik/tracks-v1a1/mono.m3u8" },
          { title: "Tv Retro", url: "https://ssh101.bozztv.com/ssh101/tvretropalmares/chunks.m3u8" },
          { title: "Canal 8", url: "https://mdstrm.com/live-stream-playlist/5a7b1e63a8da282c34d65445.m3u8" },
          { title: "Canal 6", url: "https://d1vr8yxz55pucr.cloudfront.net/index.m3u8" },
          { title: "Telesistema", url: "https://k20.usastreams.com:8081/telesistema/tracks-v1a1/mono.m3u8" },
          { title: "Canal 4", url: "https://alba-cr-repretel-c4.stream.mediatiquestream.com/index.m3u8" },
          { title: "Canal 1", url: "https://59ef525c24caa.streamlock.net/canal1cr/canal1cr/playlist.m3u8" },
          { title: "Canal 11", url: "https://alba-cr-repretel-c11.stream.mediatiquestream.com/480p.m3u8" },
          { title: "Extrema TV", url: "https://627bb251f23c7.streamlock.net:444/ExtremaTV/ExtremaTV/playlist.m3u8" },
          { title: "Nicoya tv", url: "https://59ef525c24caa.streamlock.net/nicoyatv/nicoyatv/chunklist_w1674958038.m3u8" },
          { title: "Sony Canal Novelas", url: "https://a89829b8dca2471ab52ea9a57bc28a35.mediatailor.us-east-1.amazonaws.com/v1/manifest/0fb304b2320b25f067414d481a779b77db81760d/CanelaTV_SonyCanalNovelas/546d9696-a523-4794-9d79-b340f54b6d76/5.m3u8" },
          { title: "RCN Más", url: "https://rcntv-rcnmas-1-us.plex.wurl.tv/4300.m3u8" },
          { title: "Azteca Internacional", url: "https://azt-mun.otteravision.com/azt/mun/mun_1080p.m3u8" },
        ];

        // Variable para rastrear el canal activo
        let activeIndex = parseInt(localStorage.getItem('lastPlayedIndex')) || 0;

        // Función para renderizar la lista de reproducción
        function renderPlaylist(list = defaultPlaylist) {
            playlistElement.innerHTML = '';
            list.forEach((item, index) => {
                const li = document.createElement('li');
                li.innerHTML = `<span>${item.title}</span>`;
                li.addEventListener('click', () => playVideo(item.url, index));
                if (index === activeIndex) {
                    li.classList.add('active'); // Resaltar el canal activo
                }
                playlistElement.appendChild(li);
            });
             // Scroll to active item after rendering
            const activeItem = playlistElement.querySelector('.active');
            if (activeItem) {
                activeItem.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }
        }
      // Function to handle automatic fullscreen on orientation change
        function handleOrientationChange() {
            if (window.matchMedia("(orientation: landscape)").matches) {
                // Landscape mode
                 if (!player.isFullscreen()) {
                  player.requestFullscreen();
                }
                renderPlaylist(); // Show and render playlist in landscape
            } else {
                // Portrait mode
              if (player.isFullscreen()) {
                player.exitFullscreen();
               }
            }
        }

        // Función para reproducir un video
        function playVideo(url, index) {
          player.src({ src: url, type: 'application/x-mpegURL' });

          // Set up the error listener *before* calling play()
          player.one('error', (event) => {
              console.error('Error al cargar el video:', player.error());
              // More user-friendly error handling
              let errorMsg = 'No se pudo cargar el video. Intenta con otro canal.';

              //Check network
              if (!navigator.onLine) {
                errorMsg = "No hay conexión a Internet. Por favor, verifica tu conexión.";
              }

              player.error({
                message: errorMsg, //Custom message
                code: player.error().code //keep original error code
              });

              // Optionally, automatically try the next video
               if (index < defaultPlaylist.length - 1) {
                   setTimeout(() => playVideo(defaultPlaylist[index + 1].url, index + 1), 2000); // Wait 2 seconds
               }
          });

          player.play()
              .then(() => {
                  activeIndex = index; // Actualizar el índice activo
                  localStorage.setItem('lastPlayedIndex', index); // Guardar el índice
                  renderPlaylist(); // Volver a renderizar la lista para resaltar el canal activo

              })
              .catch((error) => {
                  // Handle errors that happen *during* playback (after play() was successful)
                  // These errors might not trigger the 'error' event, so catch them here too.
                   console.error('Error during playback:', error);
                    if (index < defaultPlaylist.length - 1) {
                      // Try next video on playback error.
                      setTimeout(() => playVideo(defaultPlaylist[index+1].url, index + 1), 2000);
                  }
              });
        }



        // Función para filtrar la lista de reproducción
        function filterPlaylist() {
            const searchTerm = document.getElementById('search').value.toLowerCase();
            const filteredList = defaultPlaylist.filter(item => item.title.toLowerCase().includes(searchTerm));
            renderPlaylist(filteredList);
        }

        // Initial setup
        if (defaultPlaylist.length > 0) {
            playVideo(defaultPlaylist[activeIndex].url, activeIndex);
        }
        // Add event listener for orientation changes
        window.addEventListener('orientationchange', handleOrientationChange);

        // Initial check for orientation (in case it's already landscape)
        handleOrientationChange();


         // Prevent mobile browsers from pausing video when the tab is inactive
        document.addEventListener('visibilitychange', function() {
          if (document.hidden) {
            // Page is hidden, but we don't want to pause.
            // Video.js might try to pause, so we counteract that:
            if (!player.paused()) {
              player.play(); // Ensure it's playing (this is a bit of a hack)
            }
          }
        });

    </script>
</body>
</html>
